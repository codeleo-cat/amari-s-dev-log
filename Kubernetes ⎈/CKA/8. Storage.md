# PV and PVC
Volume - container에 access할 수 있는 일부 데이터가 포함된 디렉터리
container의 file 시스템과 연결됨.
사용하려면 ? Pod에 제공할 볼륨을 지정해야 함.

### configMap
### emptyDir

# Storage Class

hostPath PV - single node only 개발 및 테스트를 위해 지원. node의 파일이나 디렉토리를 사용하여 네트워크 연결 storage를 에뮬레이트함.

dynamic volume provisioning을 지원한다 -> 필요에 따라 자동으로 storage를 관리하고 할당할 수 있다는 걸 의미한다.

#PracticeTest
**storage class = sc**
k get sc | wc -l


---
#PracticeTest

3. The logs are stored in the Container's file system that lives only as long as the Container does. Once the pod is destroyed, you **cannot view** the logs again.
4. volume을 저장소로 사용하도록 pod 구성
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: event-simulator
    image: kodekloud/event-simulator
    env:
    - name: LOG_HANDLERS
      value: file
    volumeMounts:
    - mountPath: /log
      name: log-volume

  volumes:
  - name: log-volume
    hostPath:
      # directory location on host
      path: /var/log/webapp
      # this field is optional
      type: Directory
```

5. Create PV
https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-log
spec:
  persistentVolumeReclaimPolicy: Retain
  accessModes:
    - ReadWriteMany
  capacity:
    storage: 100Mi
  hostPath:
    path: /pv/log
```
6. Create PVC
https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims
```yaml

```
7. Check status of PVC
```
k get pvc
```

8. Check status of PV
```
k get pv
```
9. Why claim not bound to available PV ?

controlplane /var/log/webapp ➜  k describe pv pv-log
```plain
Name:            pv-log
Labels:          <none>
Annotations:     <none>
Finalizers:      [kubernetes.io/pv-protection]
StorageClass:    
Status:          Available
Claim:           
Reclaim Policy:  Retain
Access Modes:    RWX
VolumeMode:      Filesystem
Capacity:        100Mi
Node Affinity:   <none>
Message:         
Source:
    Type:          HostPath (bare host directory volume)
    Path:          /pv/log
    HostPathType:  
Events:            <none>
```

controlplane /var/log/webapp ➜  k describe pvc claim-log-1 
```plain
Name:          claim-log-1
Namespace:     default
StorageClass:  
Status:        Pending
Volume:        
Labels:        <none>
Annotations:   <none>
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      
Access Modes:  
VolumeMode:    Filesystem
Used By:       <none>
Events:
  Type    Reason         Age                   From                         Message
  ----    ------         ----                  ----                         -------
  Normal  FailedBinding  10s (x11 over 2m35s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set
```

11. change access mode
```yaml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: claim-log-1
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 50Mi
```

accessMode : ReadWriteOnce -> ReadWriteMany

k replace -f pvc.yaml --force\

12. Update the `webapp` pod to use the persistent volume claim as its storage.
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: event-simulator
    image: kodekloud/event-simulator
    env:
    - name: LOG_HANDLERS
      value: file
    volumeMounts:
    - mountPath: /log
      name: log-volume

  volumes:
  - name: log-volume
    persistentVolumeClaim:
      claimName: claim-log-1
```