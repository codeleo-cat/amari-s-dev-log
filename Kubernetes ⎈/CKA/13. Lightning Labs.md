1. Upgrade the current version of kubernetes from `1.29.0` to `1.30.0` exactly using the `kubeadm` utility. Make sure that the upgrade is carried out one node at a time starting with the controlplane node. To minimize downtime, the deployment `gold-nginx` should be rescheduled on an alternate node before upgrading each node.

Upgrade `controlplane` node first and drain node `node01` before upgrading it. Pods for `gold-nginx` should run on the `controlplane` node subsequently.
해당 노드에서 실행 중인 파드를 다른 노드로 옮겨서 ***서비스 중단을 최소화***하는 것

- [kubeadm-upgrade](https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/)

1. **controlplane node upgrade**
- master node drain
- kubeadm upgrade
- kubelet과 kubectl upgrade
- upgrade 상태 확인
- master node uncordon

2. **worker node upgrade**
	node drain
	**ssh로 해당 node 접속**
	kubeadm upgrade
	kubelet과 kubectl 업그레이드
	**해당 node exit**
	node uncordon

### check node & pod status
k get po && k get no

## Upgrading control plane nodes
cat /etc/apt/sources.list.d/kubernetes.list
```plain
deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /
```

sed -i 's/1.29/1.30/g' /etc/apt/sources.list.d/kubernetes.list

cat /etc/apt/sources.list.d/kubernetes.list 
```plain
deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /
```

```sh
kubectl drain controlplane --ignore-daemonsets
sudo apt update
sudo apt-cache madison kubeadm
```

```plain
   kubeadm | 1.30.2-1.1 | https://pkgs.k8s.io/core:/stable:/v1.30/deb  Packages
   kubeadm | 1.30.1-1.1 | https://pkgs.k8s.io/core:/stable:/v1.30/deb  Packages
   kubeadm | 1.30.0-1.1 | https://pkgs.k8s.io/core:/stable:/v1.30/deb  Packages
```

```sh
sudo apt-mark unhold kubeadm && \
sudo apt-get update && sudo apt-get install -y kubeadm='1.30.0-1.1' && \
sudo apt-mark hold kubeadm

kubeadm version
sudo kubeadm upgrade plan
sudo kubeadm upgrade apply v1.30.0
```
wait for 5m...
```plain
[upgrade/successful] SUCCESS! Your cluster was upgraded to "v1.30.0". Enjoy!

[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.
```

```sh
sudo apt-mark unhold kubelet kubectl && \
sudo apt-get update && sudo apt-get install -y kubelet='1.30.0-1.1' kubectl='1.30.0-1.1' && \
sudo apt-mark hold kubelet kubectl
kubectl uncordon controlplane
```

## Worker node upgrade
```sh
k drain node01 --ignore-daemonsets

ssh node01

vi /etc/apt/sources.list.d/kubernetes.list
sed -i 's/1.29/1.30/g' /etc/apt/sources.list.d/kubernetes.list
apt update
apt-cache madison kubeadm
apt-get install kubeadm=1.30.0-1.1

# Upgrade the node 
kubeadm upgrade node

# upgrade the version and restart Kubelet.
apt-get install kubelet=1.30.0-1.1
systemctl daemon-reload
systemctl restart kubelet

exit / logout
```

Back on the `controlplane` node:
```sh
kubectl uncordon node01
kubectl get pods -o wide | grep gold # make sure this is scheduled on a node
```